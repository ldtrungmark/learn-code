# USE: kubespray v2.20 | Racher v2.7.3c

# Change flannel

# Create env setup k8s with kubespray for cluster k8s
docker run --rm -it --mount type=bind,source=/home/trungle/learn-code/k8s/kubespray_v2.20.0,dst=/inventory \
  --mount type=bind,source=/home/trungle/.ssh/id_rsa,dst=/root/.ssh/id_rsa \
  --mount type=bind,source=/home/trungle/.ssh/id_rsa,dst=/home/sysadmin/.ssh/id_rsa  \
  quay.io/kubespray/kubespray:v2.20.0 bash 

# Setup K8S: Run in container
ansible-playbook -i /inventory/hosts.yaml cluster.yml --user=sysadmin --ask-pass --become --ask-become-pass

# Refresh catch K8S after modifed file hosts.yml for add nodes:
ansible-playbook -i /inventory/hosts.yaml facts.yml --user=sysadmin --ask-pass --become --ask-become-pass
